# species_init.yaml
# Species definitions, spawn rules, effects, and observations

# Effect types available
effect_types:
  promotes:
    description: "Increases target density"
    params: [radius, multiplier, falloff]
  excludes:
    description: "Reduces target presence"
    params: [radius, probability, falloff]
  damages:
    description: "Creates damage states"
    params: [radius, probability, state_definition]
  creates_sign:
    description: "Places observable signs"
    params: [radius, probability, terrain_filter]

# State definitions for damage effects
state_definitions:
  tree_damage:
    states:
      1: {name: healthy, symbol: null}
      2: {name: gnawed, symbol: gnaw_marks}
      3: {name: felled, symbol: stump}
    transitions:
      low: {threshold: 0.3, probs: {1: 0.8, 2: 0.2, 3: 0.0}}
      medium: {threshold: 0.6, probs: {1: 0.4, 2: 0.5, 3: 0.1}}
      high: {threshold: 1.0, probs: {1: 0.1, 2: 0.5, 3: 0.4}}

# Symbols for signs/tracks
symbols:
  tracks_cloven:
    char: "•"
    color: "#4a3728"
    description: "Cloven hoof prints"
  tracks_cloven_large:
    char: "●"
    color: "#4a3728"
    description: "Large cloven hoof prints"
  tracks_paw:
    char: "◉"
    color: "#333333"
    description: "Paw prints with claw marks"
  tracks_webbed:
    char: "⋔"
    color: "#4a5568"
    description: "Webbed footprints"
  scat_herbivore:
    char: "◆"
    color: "#5d4e37"
    description: "Herbivore droppings"
  scat_predator:
    char: "◇"
    color: "#3d3d3d"
    description: "Predator scat"
  gnaw_marks:
    char: "✕"
    color: "#8b6914"
    description: "Beaver tooth marks"
  stump:
    char: "⊥"
    color: "#654321"
    description: "Felled trunk base"
  rooting:
    char: "∿"
    color: "#5c4a3a"
    description: "Churned soil from boar"
  wallow:
    char: "≈"
    color: "#6b5344"
    description: "Muddy depression"
  lodge:
    char: "⌂"
    color: "#5d4537"
    description: "Beaver lodge"
  nest_ground:
    char: "◯"
    color: "#7c6f5a"
    description: "Ground nest"

# Tag groups
tags:
  softwood: [birch, willow, aspen, alder]
  nitrophilic: [nettles]
  wolf_prey: [red_deer, roe_deer, elk]
  bear_prey: [red_deer, roe_deer, wild_boar, elk]
  crepuscular: [red_deer, roe_deer, beaver, wild_boar]

# Human presence (special pseudo-species)
_human_presence:
  fixed_location: platform
  effects:
    - effect: promotes
      targets: {tag: nitrophilic}
      params: {radius: 15, multiplier: 5.0, falloff: linear}
    - effect: excludes
      targets: {category: [large_herbivore, predator]}
      params: {radius: 20, probability: 0.8, falloff: linear}

# Species definitions
species:

  # === TREES ===
  birch:
    id: 1
    latin: "Betula spp."
    common: "Birch"
    category: tree
    tags: [softwood]
    photo: birch.jpg
    
    distribution:
      base_density: 0.5
      terrain_weights:
        birch_woodland: 1.0
        mixed_woodland: 0.6
        grassland: 0.2
      clustering:
        type: stand
        stand_radius: [5, 15]
        trees_per_stand: [15, 100]
    
    observation:
      visual: "Slender trees with distinctive white papery bark marked by dark horizontal lines."
      tactile: "Bark peels in thin papery layers, smooth and cool to touch."
      smell: "Fresh, slightly sweet scent from new leaves."
      sound: "Leaves rustle softly in breeze."
      habitat: "Dominant in drier woodland areas."
      season_note: "Spring catkins releasing pollen. Sap rising."
      uses: "Bark for containers, tar production, tinder. Wood for tools."
      
      conditional_texts:
        - condition: "self.state == 2"
          append_to: tactile
          text: "The trunk shows beaver gnaw marks."
        - condition: "self.state == 3"
          append_to: visual
          text: "Only a pointed stump remains."

  willow:
    id: 2
    latin: "Salix spp."
    common: "Willow"
    category: tree
    tags: [softwood, wetland]
    photo: willow.jpg
    
    distribution:
      base_density: 0.4
      terrain_weights:
        carr_woodland: 1.0
        wetland: 0.8
      corridor_bonus:
        water_edge: 2.5
      max_water_distance: 5
      clustering:
        type: clump
        stems_per_clump: [3, 8]
    
    observation:
      visual: "Graceful trees with long, narrow silver-green leaves."
      tactile: "Young shoots remarkably flexible."
      smell: "Crushed leaves release fresh, slightly bitter scent."
      sound: "Warblers sing from branches."
      habitat: "Edges of water, wet ground."
      season_note: "Fuzzy catkins appearing."
      uses: "Flexible stems for basketry, fish traps."
      
      conditional_texts:
        - condition: "self.state >= 2"
          append_to: tactile
          text: "Distinctive beaver tooth marks girdle the trunk."
        - condition: "species.beaver.distance <= 3"
          append_to: habitat
          text: "Prime beaver territory - willows are their preferred food."

  alder:
    id: 3
    latin: "Alnus glutinosa"
    common: "Alder"
    category: tree
    tags: [softwood, wetland]
    photo: alder.jpg
    
    distribution:
      base_density: 0.35
      terrain_weights:
        carr_woodland: 1.0
        wetland: 0.7
      corridor_bonus:
        water_edge: 2.0
      clustering:
        type: stand
        stand_radius: [3, 10]
    
    observation:
      visual: "Medium tree with dark fissured bark. Rounded leaves with notched tips."
      tactile: "Bark rough and corky. Cut wood turns orange-red."
      smell: "Damp, earthy scent."
      sound: "Woodpeckers often drum on trunks."
      habitat: "Waterlogged ground, stream banks."
      season_note: "Purple-red catkins extending."
      uses: "Wood resists rot underwater - ideal for platforms."

  reeds:
    id: 6
    latin: "Phragmites australis"
    common: "Common Reed"
    category: plant
    photo: reed.jpg
    
    distribution:
      base_density: 0.9
      terrain_weights:
        reed_bed: 1.0
        shallow_water: 0.3
      clustering:
        type: continuous
    
    observation:
      visual: "Tall grass-like stems reaching 2-3 meters."
      tactile: "Stems hollow and rigid. Leaves sharp-edged."
      smell: "Fresh green smell mixed with slight decay."
      sound: "Dry stems rattle. Reed warblers call."
      habitat: "Shallow water margins."
      season_note: "New green shoots pushing through."
      uses: "Stems for thatching, arrow shafts."

  nettles:
    id: 7
    latin: "Urtica dioica"
    common: "Stinging Nettle"
    category: plant
    tags: [nitrophilic]
    
    distribution:
      base_density: 0.1
      terrain_weights:
        platform: 3.0
        grassland: 0.5
      clustering:
        type: patch
        patch_radius: [2, 5]
    
    observation:
      visual: "Dark green plants with heart-shaped serrated leaves."
      tactile: "WARNING: Stinging hairs cause painful rash."
      smell: "Pungent, green, slightly unpleasant."
      sound: "Buzzing of pollinators."
      habitat: "Disturbed ground, enriched soil."
      season_note: "Young spring shoots most tender."
      uses: "Young leaves edible when cooked. Stem fibers for cordage."
      
      conditional_texts:
        - condition: "terrain.current == platform"
          append_to: habitat
          text: "Thriving on the enriched soil of the occupation site."

  # === ANIMALS ===
  red_deer:
    id: 10
    latin: "Cervus elaphus"
    common: "Red Deer"
    category: large_herbivore
    tags: [wolf_prey, bear_prey, crepuscular]
    photo: red_deer.jpg
    
    distribution:
      density_per_km2: 10
      group_size: [5, 20]
      group_spread: 5
      terrain_weights:
        birch_woodland: 1.0
        mixed_woodland: 0.8
        grassland: 0.6
      corridor_bonus:
        ecotone: 1.5
        game_trail: 1.3
      avoidance:
        _human_presence: 0.8
        wolf: 0.7
        bear: 0.7
    
    observation:
      visual: "Large deer with rich reddish-brown coat. Stags carry branching antlers."
      tactile: "Tracks: Large cloven hoofprints, ~8cm long."
      smell: "Musky scent near wallows."
      sound: "Barking alarm call. Calves bleat."
      habitat: "Woodland edges, clearings."
      season_note: "Hinds with newborn calves. Stags in bachelor groups."
      uses: "PRIMARY PREY: ~80kg meat. Antler for tools, hide for clothing."
      
      conditional_texts:
        - condition: "corridor.ecotone.in"
          append_to: habitat
          text: "Feeding at the woodland edge where browse is richest."
        - condition: "species.wolf.distance <= 30"
          append_to: visual
          text: "The herd appears alert and nervous."
        - condition: "time.of_day in [dawn, dusk]"
          append_to: visual
          text: "Actively grazing - peak feeding time."
    
    effects:
      - effect: creates_sign
        sign: tracks_cloven
        params: {radius: 2, probability: 0.5}
      - effect: creates_sign
        sign: scat_herbivore
        params: {radius: 1, probability: 0.3}

  elk:
    id: 11
    latin: "Alces alces"
    common: "Elk (Moose)"
    category: large_herbivore
    tags: [wolf_prey, aquatic]
    photo: elk.jpg
    
    distribution:
      density_per_km2: 1.5
      group_size: [1, 3]
      terrain_weights:
        shallow_water: 1.0
        reed_bed: 0.9
        wetland: 0.8
      corridor_bonus:
        water_edge: 2.0
      avoidance:
        wolf: 0.6
    
    observation:
      visual: "MASSIVE deer, dark brown-black, humped shoulders."
      tactile: "Tracks: Very large cloven prints ~15cm."
      smell: "Strong musky odor."
      sound: "Usually silent. Occasional low grunt."
      habitat: "Wetlands, lake margins. Feeds on aquatic plants."
      season_note: "Cows with young calves, very protective."
      uses: "Enormous meat yield ~200kg."
      
      conditional_texts:
        - condition: "terrain.current in [shallow_water, reed_bed]"
          append_to: visual
          text: "Wading belly-deep, head submerged."
    
    effects:
      - effect: creates_sign
        sign: tracks_cloven_large
        params: {radius: 2, probability: 0.6, terrain_filter: [wetland, shallow_water]}

  beaver:
    id: 15
    latin: "Castor fiber"
    common: "European Beaver"
    category: medium_herbivore
    tags: [aquatic, nocturnal]
    
    distribution:
      density_per_km2: 0.5
      group_size: [2, 6]
      territory_type: linear_exclusive
      territory_length: 20
      terrain_weights:
        shallow_water: 1.0
        reed_bed: 0.8
      corridor_bonus:
        water_edge: 3.0
    
    observation:
      visual: "Large rodent with dense brown fur, broad flat tail."
      tactile: "Signs: Distinctive tooth marks on trees, pointed stumps."
      smell: "Castoreum scent marks - musky, strong."
      sound: "Loud tail slap as alarm. Gnawing at night."
      habitat: "Lake edges. Creates habitat by damming."
      season_note: "Kits born in lodge. Adults repairing damage."
      uses: "Highly valued fur. Castoreum for medicine."
      
      conditional_texts:
        - condition: "species.willow.state >= 2"
          radius: 3
          append_to: tactile
          text: "Fresh wood chips litter the ground."
        - condition: "time.of_day in [dawn, dusk]"
          append_to: visual
          text: "Ripples and movement near the water's edge."
        - condition: "time.of_day in [morning, midday, afternoon]"
          append_to: visual
          text: "No beaver visible - resting in lodge until dusk."
    
    effects:
      - effect: damages
        targets: {tag: softwood}
        params: {radius: 5, probability: 0.6, state_definition: tree_damage}
      - effect: creates_sign
        sign: gnaw_marks
        params: {radius: 5, probability: 0.5}
      - effect: creates_sign
        sign: lodge
        params: {radius: 0, probability: 0.8}
      - effect: creates_sign
        sign: tracks_webbed
        params: {radius: 2, probability: 0.4, terrain_filter: [shallow_water, wetland]}

  wolf:
    id: 20
    latin: "Canis lupus"
    common: "Wolf"
    category: predator
    tags: [apex_predator]
    
    distribution:
      presence_probability: 0.3
      density_per_km2: 0.02
      group_size: [3, 8]
      group_spread: 10
      terrain_weights:
        birch_woodland: 1.0
        mixed_woodland: 1.0
        grassland: 0.8
      avoidance:
        _human_presence: 0.9
    
    observation:
      visual: "Large dog-like predator, grey-brown fur, bushy tail."
      tactile: "Tracks: Large dog prints ~10cm, elongated."
      smell: "Musky canine scent at marking posts."
      sound: "Iconic howling at dusk/dawn."
      habitat: "Wide-ranging, following prey."
      season_note: "Denning season - pups born."
      uses: "Fur warm. Competitor for deer. Potential THREAT."
      
      conditional_texts:
        - condition: "time.of_day in [dawn, dusk, night]"
          append_to: sound
          text: "Distant howling echoes across the landscape."
    
    effects:
      - effect: excludes
        targets: {tag: wolf_prey}
        params: {radius: 30, probability: 0.3, falloff: linear}
      - effect: creates_sign
        sign: tracks_paw
        params: {radius: 3, probability: 0.4}
      - effect: creates_sign
        sign: scat_predator
        params: {radius: 2, probability: 0.2}

  bear:
    id: 21
    latin: "Ursus arctos"
    common: "Brown Bear"
    category: predator
    tags: [apex_predator]
    
    distribution:
      presence_probability: 0.2
      density_per_km2: 0.01
      group_size: [1, 3]
      terrain_weights:
        mixed_woodland: 1.0
        birch_woodland: 0.9
      avoidance:
        _human_presence: 0.7
    
    observation:
      visual: "Massive predator, brown fur. Distinctive shoulder hump."
      tactile: "Tracks: Huge prints showing five toes, ~25cm."
      smell: "Strong musky bear odor."
      sound: "Usually silent. Woofing alarm."
      habitat: "Woodland, forest edges."
      season_note: "MOST DANGEROUS NOW - emerging from hibernation, hungry."
      uses: "Fur prized. EXTREMELY DANGEROUS - avoid."
    
    effects:
      - effect: excludes
        targets: {tag: bear_prey}
        params: {radius: 20, probability: 0.4}
      - effect: creates_sign
        sign: tracks_paw
        params: {radius: 2, probability: 0.5}

  pike:
    id: 30
    latin: "Esox lucius"
    common: "Pike"
    category: aquatic
    photo: pike.jpg
    
    distribution:
      density_per_km2: 5
      group_size: [1, 1]
      terrain_weights:
        shallow_water: 1.0
        reed_bed: 0.8
    
    observation:
      visual: "Large predatory fish, green-gold mottling. Sharp teeth."
      tactile: "Slimy scales. Teeth will cut - handle carefully!"
      smell: "Fresh fish smell."
      sound: "Splash when striking prey."
      habitat: "Ambush predator in weed beds."
      season_note: "Post-spawning, hungry and active."
      uses: "Good eating despite bones."
      
      conditional_texts:
        - condition: "time.of_day in [dawn, dusk]"
          append_to: visual
          text: "Active and hunting - best time for spearing."

  waterfowl:
    id: 31
    latin: "Anas/Anser spp."
    common: "Waterfowl"
    category: aquatic
    
    distribution:
      density_per_km2: 15
      group_size: [2, 20]
      terrain_weights:
        shallow_water: 1.0
        reed_bed: 0.9
        wetland: 0.6
    
    observation:
      visual: "Various ducks and geese. Mallards common."
      tactile: "Webbed footprints in mud. Nests lined with down."
      smell: "Slight musty bird smell."
      sound: "Quacking ducks, honking geese."
      habitat: "Lake surface, reed beds."
      season_note: "NESTING NOW - eggs available."
      uses: "Meat, eggs, feathers, down."
      
      conditional_texts:
        - condition: "terrain.current == reed_bed"
          append_to: habitat
          text: "Nesting among the dense reeds."
    
    effects:
      - effect: creates_sign
        sign: tracks_webbed
        params: {radius: 2, probability: 0.5, terrain_filter: [shallow_water, wetland]}
      - effect: creates_sign
        sign: nest_ground
        params: {radius: 1, probability: 0.3, terrain_filter: [reed_bed]}
